<script>
    import FileViewerStyle from "./FileViewerStyle";
    import CodeView from "./CodeView";

    declare var UMD: any;

    function fromPath(e, files) {

        if (!e || !files || !files.length) {
            return null;
        }
        const owner = e.atomControl;
        owner.file = files[0];
        return files.map((p) => {
            var t = p.split("/");
            var n = t[t.length - 1];
            return {
                label: n,
                value: p
            };
        });
    }

    function setView(e, d) {
        if (!e || !d) {
            return;
        }
        const old = UMD.mock;
        UMD.mock = e.atomControl.designMode;
        const c = new (d)(e.atomControl.app);
        e.atomControl.demoPresenter.appendChild(c.element);
        UMD.mock = old;
    }

</script>
<AtomGridView
    rows="34, *"
    columns="*, 5, 50%"
    default-style="{ FileViewerStyle }"
    style-class="{ this.controlStyle.root }"
    @properties=" files: string[] = null , file: string = null, require: any = null, demo: any = null, designMode: boolean = true, demoPresenter: any = null "
    none="[ setView($this.element, $this.demo ) ]">
    <AtomToggleButtonBar
        items="[ fromPath($this.element, $this.files) ]"
        value="$[this.file]"></AtomToggleButtonBar>
    <div
        row="1" 
        class="code">
        <CodeView
            require="[$this.require]" 
            style="overflow: auto" src="[$this.file]"></CodeView>
    </div>
    <AtomGridSplitter row="1" column="1"></AtomGridSplitter>
    <div
        row="1"
        column="2" 
        presenter="demoPresenter">

    </div>
</AtomGridView>